---
layout: default
inlineCSS: >-

  .year {
    font-size: 3rem;
    font-weight: 600;
    margin-bottom: 1rem;
  }

  .card {
    padding: 1.5rem 2.2rem 1.5rem;
  }
  .pub-title {
    font-size: 2.1rem;
    margin-bottom: 0.5rem;
  }

  .pub-authors {
    font-size: 1.4rem;
  }

  .pub-venue {
    font-style: italic;
    font-size: 1.4rem;
  }
  .pub-year {
    font-size: 1.4rem;
  }
  .pub-abstract {
    margin-top: 0.2rem;
    font-size: 1.4rem;
    color: grey;
  }

  .pub-abstract.is-clamped {
    display: -webkit-box;        /* required for -webkit-line-clamp */
    -webkit-box-orient: vertical;
    -webkit-line-clamp: 3;       /* JS will overwrite this number per item */
    overflow: hidden;
  }

  .show-more {
    background: none; 
    border: 0; 
    padding: 0;
    font-size: 1.4rem;
    text-decoration: none; 
    cursor: pointer;
    font-family: var(--font-sans);
  }

  .show-more:hover {
    color: grey;
  }

  /* DOI and PDF buttons */

  .button {
    display: flex;
    gap: 0.6rem;
    padding: 0.5rem 0.8rem;
    border: 1px solid  var(--color-border);
    border-radius: 8px;
    background-color: white;
    color: var(--color-link);
    font-size: 1.2rem;
    cursor: pointer;
    transition: background-color 0.2s ease, color 0.2s ease;
  }

  .button:hover {
    background-color: #e0e0e0; /* slightly grey */
    color: #000;
  }

  .conf-badge {
    display: inline-block;
    margin-right: 0.1em;
    padding: 0.15em 0.25em;

    font-size: 1.7rem;
    font-weight: 300;

    border-radius: 4px;
    background-color: var(--color-link);
    color: white;

    vertical-align: top;
  }
---
{% for year in site.data.publications %}
  <div class="year">{{ year[0] }}</div>
  {% for pub in year[1] %}
      <div class="card">
        <a class="conf-badge" href="{{ pub.venue_link }}">{{ pub.acronym }}</a>
        <span class="pub-title">{{ pub.title }}</span>
          {% assign formatted_authors = "" %}
          {% assign has_equal_contrib = false %}

          {% for author in pub.authors %}
            {% assign author_name = author.name | default: author %}

            {% if author.equal %}
              {% assign has_equal_contrib = true %}
              {% assign author_display = author_name | append: "<sup>*</sup>" %}
            {% else %}
              {% assign author_display = author_name %}
            {% endif %}

            {% if author_name == "Andrea Gilot" %}
              {% assign author_display = "<b>" | append: author_display | append: "</b>" %}
            {% endif %}

            {% assign formatted_authors = formatted_authors | append: author_display %}

            {% unless forloop.last %}
              {% assign formatted_authors = formatted_authors | append: "||" %}
            {% endunless %}
          {% endfor %}
        <div class="pub-authors">
          {{ formatted_authors | split: "||" | array_to_sentence_string }}
          {% if has_equal_contrib %}
            <span class="equal-contrib">
              <em>(* equal contributions)</em>
            </span>
          {% endif %}
        </div>
        <div style="display: flex; gap: 0.4rem;">
          <div class="pub-venue">
            {% if pub.venue %}
              {{ pub.venue }}
            {% endif %}
          </div>
        </div>
        <div class="pub-abstract js-truncate" id="abstract" data-lines="3">
          {{ pub.abstract }}
        </div>
        <div style="display: flex; margin-top: 0.5rem; gap: 0.7rem;">
          {% if pub.DOI %}
            <a href="{{ pub.DOI }}" class="button">
              <i class="fa-solid fa-link" aria-hidden="true"></i><div>DOI</div>
            </a>
          {% endif %}
          {% if pub.PDF %}
            <a href="{{ pub.PDF }}" class="button">
              <i class="fa-solid fa-file-pdf" aria-hidden="true"></i> <div>PDF</div>
            </a>
          {% endif %}
          {% if pub.artifact %}
            <a href="{{ pub.artifact }}" class="button">
              <i class="fa-solid fa-box-archive" aria-hidden="true"></i> <div>Artifact</div>
            </a>
          {% endif %}
        </div>

      </div>
  {% endfor %}
  <br>
{% endfor %}

<script>
document.addEventListener("DOMContentLoaded", function () {
  const blocks = document.querySelectorAll(".js-truncate");

  blocks.forEach((el, idx) => {
    // 1) How many lines? (data-lines or default 3)
    const lines = parseInt(el.dataset.lines, 10) || 3;

    // 2) Apply the clamp class and set the clamp count
    el.classList.add("is-clamped");
    el.style.webkitLineClamp = String(lines); // Chrome/Safari/Edge
    // If Firefox supports 'line-clamp' in your target, you can also set:
    // el.style.lineClamp = String(lines);

    // 3) If nothing actually overflows, skip the button
    //    (need to wait a frame to let layout settle)
    requestAnimationFrame(() => {
      const overflowing = el.scrollHeight > el.clientHeight + 1;
      if (!overflowing) return;

      // 4) Make the "Show more" button
      const btn = document.createElement("button");
      btn.type = "button";
      btn.className = "show-more";
      btn.setAttribute("aria-expanded", "false");

      // Ensure each abstract has a unique id for aria-controls
      const id = el.id || `abstract-${idx}`;
      el.id = id;
      btn.setAttribute("aria-controls", id);
      btn.textContent = "Show more";

      // 5) Expand on click: remove clamp, update a11y, hide button
      btn.addEventListener("click", () => {
        el.classList.remove("is-clamped");
        el.style.webkitLineClamp = null;
        btn.setAttribute("aria-expanded", "true");
        btn.style.display = "none";
      });

      // 6) Insert the button right after the abstract
      const controls = document.createElement("div");
      controls.className = "abstract-controls";
      controls.appendChild(btn);
      el.insertAdjacentElement("afterend", controls);
    });
  });
});
</script>

